<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    {% set settings = site_settings() %}
    <title>{% block title %}{{ settings.site_title }}{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Quicksand:wght@500;600&family=Baloo+2:wght@500;600&family=Comfortaa:wght@500;600&family=Josefin+Sans:wght@500;600&display=swap" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/styles.css') }}" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@v3.0.0/dist/cookieconsent.css" rel="stylesheet">
    {% if settings.site_icon %}
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,{{ settings.site_icon|b64encode }}">
    {% else %}
    <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='img/autumn-leaf.svg') }}">
    {% endif %}
    
</head>
<body class="theme-{{ current_user.seasonal_theme if current_user.is_authenticated else 'autumn' }}">
    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" href="{{ url_for('profile.dashboard') }}">
                {% set theme_icons = {
                    'autumn': ('img/autumn-leaf.svg', 'Leaf'),
                    'winter': ('img/winter-snowflake.svg', 'Snowflake'),
                    'spring': ('img/spring-flower.svg', 'Flower'),
                    'summer': ('img/summer-sun.svg', 'Sun')
                } %}
                {% set current_theme = current_user.seasonal_theme if current_user.is_authenticated else 'autumn' %}
                {% set icon_info = theme_icons[current_theme] %}
                <img src="{{ url_for('static', filename=icon_info[0]) }}" alt="{{ icon_info[1] }}" class="me-2" style="width: 24px; height: 24px;">
                {{ settings.site_title }}
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    {% if current_user.is_authenticated %}
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('profile.dashboard') }}">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('profile.edit_profile') }}">Edit Profile</a>
                    </li>
                    {% if current_user.is_admin %}
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('admin.dashboard') }}">Admin Dashboard</a>
                    </li>
                    {% endif %}
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('auth.logout') }}">Logout</a>
                    </li>
                    {% else %}
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('auth.login') }}">Login</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('auth.register') }}">Register</a>
                    </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
    </div>

    <footer class="footer mt-5 py-3">
        <div class="container text-center">
            {% if settings.footer_text %}
                {{ settings.footer_text|safe }}
            {% endif %}
            <div class="mt-2">
                <a href="{{ url_for('privacy') }}" class="text-muted">Privacy Policy</a>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@v3.0.0/dist/cookieconsent.umd.js"></script>
    <script>
        // Wait for script to load
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof initCookieConsent === 'undefined') {
                console.error('Cookie consent library not loaded');
                return;
            }
            
            var cc = initCookieConsent();
            cc.run({
                current_lang: 'en',
                autoclear_cookies: true,
                theme_css: "https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@v3.0.0/dist/cookieconsent.css",
                page_scripts: true,
                
                gui_options: {
                    consent_modal: {
                        layout: 'cloud',
                        position: 'bottom center',
                        transition: 'slide'
                    },
                    settings_modal: {
                        layout: 'box',
                        transition: 'slide'
                    }
                },

                onFirstAction: function(user_preferences, cookie){
                    // callback triggered only once on first accept/reject
                },

                onAccept: function (cookie) {
                    // ...
                },

                languages: {
                    en: {
                        consent_modal: {
                            title: 'üç™ Cookie Consent',
                            description: 'We use cookies to enhance your browsing experience, serve personalized content, and analyze our traffic. By clicking "Accept all", you consent to our use of cookies. Visit our Privacy Policy for more information.',
                            primary_btn: {
                                text: 'Accept all',
                                role: 'accept_all'
                            },
                            secondary_btn: {
                                text: 'Settings',
                                role: 'settings'
                            }
                        },
                        settings_modal: {
                            title: 'Cookie Settings',
                            save_settings_btn: 'Save settings',
                            accept_all_btn: 'Accept all',
                            reject_all_btn: 'Reject all',
                            close_btn_label: 'Close',
                            cookie_table_headers: [
                                {col1: 'Name'},
                                {col2: 'Domain'},
                                {col3: 'Description'}
                            ],
                            blocks: [
                                {
                                    title: 'Essential cookies',
                                    description: 'These cookies are necessary for the website to function and cannot be disabled.',
                                    toggle: {
                                        value: 'necessary',
                                        enabled: true,
                                        readonly: true
                                    }
                                },
                                {
                                    title: 'Session cookies',
                                    description: 'These cookies are used to maintain your session and preferences.',
                                    toggle: {
                                        value: 'session',
                                        enabled: true,
                                        readonly: false
                                    }
                                }
                            ]
                        }
                    }
                }
            });
        });
    </script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>
